<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maternity AI Photoshoot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #f0f4f8; /* A soft, light blue-gray background */
    }
    .hidden {
      display: none;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-in-out forwards;
    }
    .loader-dot {
      animation: pulse 1.4s infinite ease-in-out both;
    }
    .loader-dot:nth-child(1) { animation-delay: -0.32s; }
    .loader-dot:nth-child(2) { animation-delay: -0.16s; }
    @keyframes pulse {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1.0); }
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://aistudiocdn.com/@google/genai@^1.26.0"
      }
    }
  </script>
</head>
<body class="bg-gray-50 font-sans text-gray-800 antialiased">

  <main class="container mx-auto px-4 py-8 md:py-12">
    <header class="text-center mb-10">
      <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 tracking-tight">
        Maternity AI Photoshoot
      </h1>
      <p class="mt-3 max-w-2xl mx-auto text-lg text-gray-500">
        Create your dream maternity photos in seconds. Upload your face, pick a style, and let AI do the magic.
      </p>
    </header>

    <!-- Main Form View -->
    <div id="main-form" class="max-w-4xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
        <div class="w-full">
          <h2 class="text-2xl font-bold mb-4 text-gray-700">1. Upload Your Face</h2>
          <div id="image-uploader-container"></div>
        </div>
        <div class="w-full">
          <h2 class="text-2xl font-bold mb-4 text-gray-700">2. Select a Style</h2>
          <div id="style-selector-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
        </div>
      </div>

      <div class="mt-8">
        <h2 class="text-2xl font-bold mb-4 text-gray-700">3. Describe Pose & Expression <span class="text-gray-400 font-normal">(Optional)</span></h2>
        <textarea
          id="custom-prompt-textarea"
          placeholder="e.g., 'Hands gently holding the belly, smiling softly at the camera.'"
          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-pink-400 transition-shadow duration-200"
          rows="3"
          aria-label="Custom pose and expression prompt"
        ></textarea>
      </div>
      
      <div class="mt-12 text-center">
        <p id="error-message" class="text-red-500 mb-4 hidden"></p>
        <button
          id="generate-button"
          disabled
          class="inline-flex items-center justify-center px-8 py-4 border border-transparent text-lg font-medium rounded-full shadow-lg text-white bg-pink-500 hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition-all duration-300 ease-in-out transform hover:scale-105 disabled:bg-gray-300 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none"
        >
          <!-- Button content will be injected by JS -->
        </button>
      </div>
    </div>

    <!-- Generated Image View -->
    <div id="generated-image-section" class="hidden max-w-2xl mx-auto text-center animate-fade-in">
      <h2 class="text-3xl font-bold mb-6 text-gray-800">Your Photoshoot is Ready!</h2>
      <div class="shadow-2xl rounded-lg overflow-hidden mb-4">
        <a id="generated-image-link" href="" target="_blank" rel="noopener noreferrer">
            <img id="generated-image-element" src="" alt="Generated maternity photoshoot" class="w-full h-auto" />
        </a>
      </div>
      <p class="text-gray-600 mb-8">
        Click the image to open it, then long-press (on mobile) or right-click to save.
      </p>
      <div class="flex justify-center">
        <button
          id="reset-button"
          class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-full shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105"
        >
          Start Over
        </button>
      </div>
    </div>
  </main>
  
  <footer class="text-center py-6 text-gray-500 text-sm">
    <p>Powered by Gemini AI</p>
  </footer>

  <script type="module">
    import { GoogleGenAI, Modality } from "@google/genai";

    // --- STATE MANAGEMENT ---
    let state = {
      uploadedImage: null,
      selectedStyle: null,
      customPrompt: '',
      generatedImage: null,
      isLoading: false,
      error: null,
    };

    // --- CONSTANTS ---
    const PHOTOSHOOT_STYLES = [
        { id: 'fairy', name: 'Ethereal Fairy', previewImage: 'https://picsum.photos/seed/fairy/300/300', prompt: 'Create a photorealistic maternity photoshoot in an ethereal fairy style. The setting is an enchanted, glowing forest at twilight. The subject is wearing a flowing, gossamer gown adorned with delicate flowers, with iridescent fairy wings. The mood is magical, dreamy, and serene.' },
        { id: 'glamour', name: 'Classic Glamour', previewImage: 'https://picsum.photos/seed/glamour/300/300', prompt: 'Create a photorealistic, classic glamour maternity photoshoot reminiscent of old Hollywood. The subject is wearing a luxurious silk or satin gown. The lighting is dramatic and elegant, using soft shadows to create a sophisticated and timeless portrait.' },
        { id: 'bohemian', name: 'Bohemian Chic', previewImage: 'https://picsum.photos/seed/bohemian/300/300', prompt: 'Create a photorealistic, bohemian chic maternity photoshoot. The setting is a sun-drenched field of wildflowers or a rustic, cozy outdoor location. The subject is wearing a lace or macrame dress with natural, earthy accessories. The mood is free-spirited, romantic, and warm.' },
        { id: 'vintage', name: 'Vintage Film', previewImage: 'https://picsum.photos/seed/vintage/300/300', prompt: 'Create a photorealistic, vintage-inspired maternity photoshoot with the look of 1960s or 7s film photography. The subject is wearing a classic vintage-style dress. The color palette is warm with a slight grain, evoking a sense of nostalgia and charming elegance.'},
        { id: 'minimalist', name: 'Minimalist', previewImage: 'https://picsum.photos/seed/minimalist/300/300', prompt: 'Create a photorealistic, minimalist maternity photoshoot. The setting is a simple studio with a neutral, seamless background. The subject is wearing simple, elegant clothing that beautifully showcases the pregnant form. The mood is clean, modern, and focused on emotion and connection.'},
        { id: 'underwater', name: 'Underwater', previewImage: 'https://picsum.photos/seed/underwater/300/300', prompt: 'Create a photorealistic, underwater maternity photoshoot. The subject is gracefully suspended in clear, tranquil blue water, with fabrics from her gown flowing around her. The lighting is diffused and ethereal, creating a weightless and dreamlike scene.'},
        { id: 'fantasy', name: 'Fantasy Art', previewImage: 'https://picsum.photos/seed/fantasy/300/300', prompt: 'Create a photorealistic, fantasy art style maternity photoshoot. The subject is depicted as a mythical queen or goddess in an epic, otherworldly landscape. She wears ornate, fantastical attire. The mood is powerful, dramatic, and awe-inspiring.'},
        { id: 'cultural', name: 'Cultural Celebration', previewImage: 'https://picsum.photos/seed/cultural/300/300', prompt: 'Create a photorealistic maternity photoshoot celebrating cultural heritage. The subject is wearing beautiful, traditional garments and accessories specific to a culture. The setting is rich with meaningful details. The mood is proud, vibrant, and deeply personal.'},
        { id: 'urban', name: 'Urban Maternity', previewImage: 'https://picsum.photos/seed/urban_m/300/300', prompt: 'Create a photorealistic, urban maternity photoshoot on a stylish city street or rooftop at golden hour. The subject wears a modern, fashionable outfit. The mood is confident, chic, and cosmopolitan, with the city lights creating a beautiful bokeh background.'},
        { id: 'nature', name: 'Nature-Inspired', previewImage: 'https://picsum.photos/seed/nature/300/300', prompt: 'Create a photorealistic, nature-inspired maternity photoshoot in a dramatic landscape, like majestic mountains, a dense forest, or by a serene lake. The subject is wearing natural fabrics, appearing grounded and deeply connected to the elements. The mood is powerful, serene, and wild.'}
    ];
    
    // --- ICONS ---
    const SparklesIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" class="w-6 h-6 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.293 2.293a1 1 0 010 1.414L10 16l-4 4-4-4 5.293-5.293a1 1 0 011.414 0L10 12m0 0l2 2m-2-2l-2-2"/></svg>`;
    const UploadIcon = `<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16" class="w-10 h-10 mb-3 text-gray-400"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/></svg>`;
    const CheckIcon = `<svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg>`;
    
    // --- GEMINI SERVICE ---
    const API_KEY = "AIzaSyBqD4-3jS4Onq1hAoc9wOBZte2m0c7cnUQ";
    if (!API_KEY) {
        alert("API_KEY environment variable not set. Please configure it to use this application.");
    }
    const ai = new GoogleGenAI({ apiKey: API_KEY });

    const getMimeType = (base64Image) => base64Image.match(/^data:(image\/[a-zA-Z]+);base64,/)?.[1] || 'image/png';
    const cleanBase64 = (base64Image) => base64Image.replace(/^data:image\/[a-zA-Z]+;base64,/, '');

    const generateMaternityPhoto = async (base64Image, stylePrompt, customPrompt) => {
        const model = 'gemini-2.5-flash-image';
        const mimeType = getMimeType(base64Image);
        const cleanedBase64Data = cleanBase64(base64Image);

        let prompt = `Using the face from the provided image, ${stylePrompt}`;
        if (customPrompt && customPrompt.trim() !== '') {
            prompt += ` The subject's pose and expression should be: ${customPrompt.trim()}.`;
        }
        prompt += ` Ensure the final image is high-resolution and photorealistic.`;
        
        try {
            const response = await ai.models.generateContent({
                model: model,
                contents: {
                    parts: [
                        { inlineData: { data: cleanedBase64Data, mimeType: mimeType } },
                        { text: prompt },
                    ],
                },
                config: { responseModalities: [Modality.IMAGE] },
            });

            const firstPart = response.candidates?.[0]?.content?.parts?.[0];
            if (firstPart?.inlineData) {
                return `data:${firstPart.inlineData.mimeType};base64,${firstPart.inlineData.data}`;
            } else {
                throw new Error('No image data found in the API response.');
            }
        } catch (error) {
            console.error('Error generating image with Gemini:', error);
            throw new Error('Failed to communicate with the AI model.');
        }
    };

    // --- DOM ELEMENTS ---
    const mainForm = document.getElementById('main-form');
    const generatedImageSection = document.getElementById('generated-image-section');
    const imageUploaderContainer = document.getElementById('image-uploader-container');
    const styleSelectorGrid = document.getElementById('style-selector-grid');
    const customPromptTextarea = document.getElementById('custom-prompt-textarea');
    const generateButton = document.getElementById('generate-button');
    const resetButton = document.getElementById('reset-button');
    const generatedImageElement = document.getElementById('generated-image-element');
    const generatedImageLink = document.getElementById('generated-image-link');
    const errorMessageElement = document.getElementById('error-message');

    // --- RENDER FUNCTIONS ---

    function renderApp() {
        // Show/hide main sections
        if (state.generatedImage) {
            mainForm.classList.add('hidden');
            generatedImageSection.classList.remove('hidden');
            generatedImageElement.src = state.generatedImage;
            generatedImageLink.href = state.generatedImage;
        } else {
            mainForm.classList.remove('hidden');
            generatedImageSection.classList.add('hidden');
        }

        // Update Generate Button
        generateButton.disabled = !state.uploadedImage || !state.selectedStyle || state.isLoading;
        if (state.isLoading) {
            generateButton.innerHTML = `
                <div class="flex items-center justify-center space-x-2">
                    <div class="w-4 h-4 rounded-full loader-dot bg-white"></div>
                    <div class="w-4 h-4 rounded-full loader-dot bg-white"></div>
                    <div class="w-4 h-4 rounded-full loader-dot bg-white"></div>
                    <span class="ml-2">Generating...</span>
                </div>`;
        } else {
            generateButton.innerHTML = `${SparklesIcon} Generate Photoshoot`;
        }

        // Update Error Message
        if (state.error) {
            errorMessageElement.textContent = state.error;
            errorMessageElement.classList.remove('hidden');
        } else {
            errorMessageElement.classList.add('hidden');
        }
    }

    function renderStyleSelector() {
        styleSelectorGrid.innerHTML = '';
        PHOTOSHOOT_STYLES.forEach(style => {
            const isSelected = state.selectedStyle?.id === style.id;
            const card = document.createElement('div');
            card.className = `
                cursor-pointer group rounded-lg overflow-hidden shadow-md 
                transform transition-all duration-300 hover:scale-105 hover:shadow-xl
                focus:outline-none focus:ring-4 focus:ring-pink-400 focus:ring-opacity-50
                ${isSelected ? 'ring-4 ring-pink-500' : 'ring-2 ring-transparent'}
            `;
            card.tabIndex = 0;
            card.innerHTML = `
                <div class="relative">
                    <img src="${style.previewImage}" alt="${style.name}" class="w-full h-full object-cover aspect-square" />
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-end p-2 transition-opacity duration-300">
                        <h3 class="text-white text-sm font-semibold text-center w-full">${style.name}</h3>
                    </div>
                    ${isSelected ? `<div class="absolute inset-0 bg-white bg-opacity-20 flex items-center justify-center">${CheckIcon}</div>` : ''}
                </div>
            `;
            card.addEventListener('click', () => handleStyleSelect(style));
            card.addEventListener('keypress', (e) => e.key === 'Enter' && handleStyleSelect(style));
            styleSelectorGrid.appendChild(card);
        });
    }
    
    function renderImageUploader() {
        const hasPreview = !!state.uploadedImage;
        imageUploaderContainer.innerHTML = `
            <input type="file" id="file-input" accept="image/png, image/jpeg, image/webp" class="hidden" />
            <label id="drop-zone" class="flex flex-col items-center justify-center w-full aspect-square border-2 border-dashed rounded-lg cursor-pointer transition-colors duration-200 ${hasPreview ? 'border-pink-300' : 'border-gray-300 bg-gray-50 hover:bg-gray-100'}">
                ${hasPreview
                    ? `<img src="${state.uploadedImage}" alt="Image preview" class="object-cover w-full h-full rounded-lg" />`
                    : `<div class="flex flex-col items-center justify-center pt-5 pb-6 text-center p-4">
                            ${UploadIcon}
                            <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                            <p class="text-xs text-gray-500">PNG, JPG, or WEBP</p>
                       </div>`
                }
            </label>
            ${hasPreview
                ? `<button id="change-photo-button" class="w-full mt-4 py-2 px-4 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors">Change Photo</button>`
                : ''
            }
            <p id="uploader-error" class="mt-2 text-sm text-red-600 hidden"></p>
        `;
        
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const changePhotoButton = document.getElementById('change-photo-button');

        const triggerFileInput = () => fileInput.click();
        
        dropZone.addEventListener('click', (e) => {
             // Only trigger file input if there's no preview. If there is, it behaves like a normal image container.
            if (!state.uploadedImage) {
                 triggerFileInput();
            }
        });
        changePhotoButton?.addEventListener('click', triggerFileInput);
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files?.[0]) {
                processFile(e.target.files[0]);
            }
        });

        dropZone.addEventListener('dragover', (e) => e.preventDefault());
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            if (e.dataTransfer.files?.[0]) {
                processFile(e.dataTransfer.files[0]);
            }
        });
    }

    // --- EVENT HANDLERS & LOGIC ---

    function processFile(file) {
        const uploaderError = document.getElementById('uploader-error');
        if (!file.type.startsWith('image/')) {
            uploaderError.textContent = 'Please select an image file.';
            uploaderError.classList.remove('hidden');
            return;
        }
        uploaderError.classList.add('hidden');

        const reader = new FileReader();
        reader.onloadend = () => {
            handleImageUpload(reader.result);
        };
        reader.onerror = () => {
            uploaderError.textContent = 'Failed to read file.';
            uploaderError.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
    }
    
    function handleImageUpload(base64Image) {
        state.uploadedImage = base64Image;
        state.generatedImage = null;
        state.error = null;
        renderImageUploader(); // Re-render the uploader with the preview
        renderApp();
    }

    function handleStyleSelect(style) {
        state.selectedStyle = style;
        state.generatedImage = null;
        state.error = null;
        renderStyleSelector(); // Re-render styles to show selection
        renderApp();
    }

    async function handleGenerate() {
        if (!state.uploadedImage || !state.selectedStyle) {
            state.error = 'Please upload an image and select a style.';
            renderApp();
            return;
        }

        state.isLoading = true;
        state.error = null;
        state.generatedImage = null;
        renderApp();

        try {
            const result = await generateMaternityPhoto(state.uploadedImage, state.selectedStyle.prompt, state.customPrompt);
            state.generatedImage = result;
        } catch (err) {
            console.error(err);
            state.error = 'Failed to generate image. Please try again.';
        } finally {
            state.isLoading = false;
            renderApp();
        }
    }

    function handleReset() {
        state.uploadedImage = null;
        state.selectedStyle = null;
        state.generatedImage = null;
        state.isLoading = false;
        state.error = null;
        state.customPrompt = '';
        customPromptTextarea.value = '';

        renderImageUploader();
        renderStyleSelector();
        renderApp();
    }

    // --- INITIALIZATION ---
    function init() {
        renderImageUploader();
        renderStyleSelector();
        renderApp();

        generateButton.addEventListener('click', handleGenerate);
        resetButton.addEventListener('click', handleReset);
        customPromptTextarea.addEventListener('input', (e) => {
            state.customPrompt = e.target.value;
        });
    }

    // Start the app
    init();
  </script>
</body>
</html>
